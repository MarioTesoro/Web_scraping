function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var signinbox={logCount:0,doingLogin:!1,inputFocused:!1,containerWidth:889,signInUtilModal:{},recaptchaCompleted:!1,show:function(e){var o=document.getElementById("signinModal"),t=-1<window.location.href.indexOf("awards/nominees")?document.querySelectorAll(".voteList"):document.getElementById("headerLoginLink");if(navigator.userAgent&&navigator.userAgent.match(/PLAYSTATION/))return document.location.assign("http://"+location.hostname+"/login"),!1;"block"!=o.style.display&&null!=t&&(openModal(e),appendedTasteProfile("js-tasteProfileLoginModal"),document.getElementById("usernameModal").focus())},hide:function(){document.querySelectorAll(".signinError").style.display="none",document.querySelectorAll(".js-signinUsernameModal").value="",document.getElementById("js-signinPasswordModal").value="",document.getElementById("js-redirect").value=""}};function openModal(r){var l,e=document.getElementById("signinModal"),o=document.querySelectorAll(".js_closeModal");e&&(l=r,signinbox.signInUtilModal=new MG_Modal({content:e}),null!==typeof signinbox.signInUtilModal&&signinbox.signInUtilModal.openModal(function(e,o){var t=o.querySelectorAll(".js-signinUsernameModal");if((r=o.querySelectorAll("[class*=loginAccessTitle]"))[0].innerHTML=l||textPHTranslation.loginTitle,0<=r[0].innerHTML.toLowerCase().indexOf("subscribe")){var n=document.getElementsByClassName("js-loginFormModal"),a=document.createElement("input");for(a.type="hidden",a.name="subscribe",a.value=1,i=0;i<n.length;i++)n[i].appendChild(a)}t[0].focus(),passEvents(o),showCaptcha&&(initializeCaptcha(),toggleButtonDisable(!0))}),MG_Utils.addEventHandler(o,"click",function(){void 0!==signinbox.signInUtilModal&&(signinbox.signInUtilModal.closeModal(),signinbox.recaptchaCompleted=!1)}))}var expired_modal={premiumPromoModal:document.getElementById("premium-promo-modal"),expiredCovidModalContent:document.getElementById("premium-covid-expired-modal"),isExpiredPromoUser:!1,startPremiumUrl:"",noThanksBtnUrl:"",segment:"",promoUser:"",init:function(){this.premiumPromoModal&&(this.promoModal=new MG_Modal({content:this.premiumPromoModal,className:"premiumPromoModalContainer",closeDocument:!1})),this.expiredCovidModalContent&&(this.expiredCovidModal=new MG_Modal({content:this.expiredCovidModalContent,className:"expiredCovidModalContainer",closeDocument:!1}))},showExpiredPromoModal:function(){var e=this,o="gay"===this.segment?"promoModalWrapperGay":"promoModalWrapperStraight",t=this.isExpiredPromoUser?"promoModalWrapperExpired":"";signinbox.signInUtilModal.closeModal(),setTimeout(function(){e.promoModal.openModal(),$j(".premiumPromoModalContainer .promoModalWrapper").addClass(o),$j(".premiumPromoModalContainer .promoModalWrapper").addClass(t),e.attachHandlers()},0)},showExpiredCovidModal:function(){var e;void 0!==this.expiredCovidModal&&(e=this,signinbox.signInUtilModal.closeModal(),setTimeout(function(){e.expiredCovidModal.openModal(),$j(".expiredCovidModalContainer .freeWeek").on("click",function(){document.location.assign(e.startPremiumUrl)}),$j(".expiredCovidModalContainer .closeMTubes, .expiredCovidModalContainer #promoCancelFreeWeek").on("click",function(){document.location.assign(e.noThanksBtnUrl)})},0))},attachHandlers:function(){var e=this;$j(".premiumPromoModalContainer .freePromoWeek").on("click",function(){document.location.assign(e.startPremiumUrl)}),$j(".premiumPromoModalContainer #promoCancelFreeWeek, .premiumPromoModalContainer .closeMTubes").on("click",function(){document.location.assign(e.noThanksBtnUrl)})}};function initializeCaptcha(){try{var e=currentModalScope.querySelector(".g-recaptcha");null!=("undefined"==typeof CaptachaComponents?"undefined":_typeof(CaptachaComponents))&&e&&CaptachaComponents.registerComponent(e,captchaAcknowledgement)}catch(e){}}function captchaAcknowledgement(e,o){if(e)switch(e){case"verified":toggleButtonDisable(!(signinbox.recaptchaCompleted=!0));break;case"expired":case"error":toggleButtonDisable(!0);break;default:return}}function toggleButtonDisable(e){var o=currentModalScope.querySelector(".js-signinUsernameModal"),t=currentModalScope.querySelector(".js-signinPasswordModal"),n=currentModalScope.querySelector(".js-loginSubmitModal");e?(MG_Utils.removeEventHandler(n,"click",loginClickFunction),MG_Utils.removeEventHandler(o,"keydown",keyDownFunction),MG_Utils.removeEventHandler(t,"keydown",keyDownFunction),MG_Utils.addClass(n,"disabled")):(MG_Utils.addEventHandler(n,"click",loginClickFunction),MG_Utils.addEventHandler(o,"keydown",keyDownFunction),MG_Utils.addEventHandler(t,"keydown",keyDownFunction),MG_Utils.removeClass(n,"disabled"))}function loginAjaxModal(e,o,t){var c,t=signinbox.recaptchaCompleted?updateDataWithCaptcha(t):t;toggleButtonDisable(!0),XMLHttpRequest&&((c=new XMLHttpRequest).open(o,e,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),c.onreadystatechange=function(){var e,o,t,n,a,i,r,l,s,d;4===c.readyState&&(200<=c.status&&c.status<400?(e=JSON.parse(c.responseText)).twoStepVerification?(i=document.querySelectorAll(".js-loginFormModal")[1],o=document.querySelectorAll(".js-userVerificationModal")[1],i&&MG_Utils.addClass(i,"hidden"),o&&(MG_Utils.removeClass(o,"hidden"),t=o.querySelector("#userPhoneNumber"),n=o.querySelector("#enterVerificationCode"),a=o.querySelector("#btnVerifyCode"),i=o.querySelector("#verificationEnabledUsername"),s=o.querySelector("#verificationEnabledToken"),d=o.querySelector("#resendVerificationCode"),r=o.querySelector("#authyIdHashed"),l=o.querySelector("#authyId"),t&&(t.innerHTML=e.phoneNumber),i&&s&&(i.value=e.username,s.value=e.autoLoginParameter),l&&r&&(l.value=e.authyId,r.value=e.authyIdHashed),n&&a&&(MG_Utils.addEventHandler(n,"keyup",function(e){""!==n.value?MG_Utils.hasClass(a,"disabled")&&MG_Utils.removeClass(a,"disabled"):MG_Utils.hasClass(a,"disabled")||MG_Utils.addClass(a,"disabled")}),MG_Utils.addEventHandler(document.querySelector("#modalWrapMTubes #btnVerifyCode"),"click",function(e){e.preventDefault(),MG_Utils.hasClass(document.querySelector("#modalWrapMTubes #btnVerifyCode"),"disabled")||loginTwoStepVerificationEnabled()}),MG_Utils.addEventHandler(n,"keydown",function(e){var o=e.which||e.keyCode;13===o&&(e.preventDefault(),MG_Utils.hasClass(a,"disabled")||loginTwoStepVerificationEnabled()),69===o&&e.preventDefault()})),d&&MG_Utils.addEventHandler(d,"click",function(e){e.preventDefault();var o=l.value,t=r.value,e=document.querySelector("#modalWrapMTubes #xsrfToken"),n=document.querySelector("#modalWrapMTubes .resendCodeResponse");e&&(e=e.value,$j.ajax({type:"POST",url:TOP_BODY.urlResendCode,dataType:"json",data:{authyId:o,authyIdHashed:t,token:e},success:function(e){var o;n&&(MG_Utils.removeClass(n,"hidden"),"success"!=e.status?(MG_Utils.addClass(n,"verificationError"),$j(n).find(".resendCodeStatus").text(e.status+":"),(o=n&&n.querySelector(".resendCodeMessage"))&&(o.innerHTML=e.message+" "+TOP_BODY&&TOP_BODY.ajaxError)):(MG_Utils.hasClass(n,"verificationError")&&MG_Utils.removeClass(n,"verificationError"),MG_Utils.addClass(n,"verificationSuccess"),$j(n).find(".resendCodeStatus").text(e.status+":"),$j(n).find(".resendCodeMessage").text(e.message),setTimeout(function(){MG_Utils.addClass(n,"hidden")},3e3)))},error:function(){alert(TOP_BODY.ajaxError),document.location.reload()}}))}))):e.requireCaptcha?(showCaptcha=!0,s=currentModalScope.querySelector(".g-recaptcha"),(d=currentModalScope.querySelector(".signinError")).style.display="block",d.innerHTML=e.message,null!=("undefined"==typeof CaptachaComponents?"undefined":_typeof(CaptachaComponents))&&(signinbox.recaptchaCompleted?CaptachaComponents.resetCaptcha():CaptachaComponents.registerComponent(s,captchaAcknowledgement))):callbackSuccess(e):(toggleButtonDisable(!1),callbackFailed()))},c.send(t))}function loginTwoStepVerificationEnabled(){$j.ajax({type:"POST",url:TOP_BODY.twoStepVerificationLogin,data:$j("#modalWrapMTubes .js-userVerificationModal").serialize(),success:function(e){var o=document.querySelector("#modalWrapMTubes .twoStepVerificationMessage");o&&MG_Utils.removeClass(o,"hidden"),"0"!=e.success?(o&&MG_Utils.hasClass(o,"verificationError")&&MG_Utils.removeClass(o,"verificationError"),MG_Utils.addClass(o,"verificationSuccess"),o.innerHTML=TOP_BODY.verificationSuccessfulMessage+"...",callbackSuccess(e)):""!=e.message&&o?(MG_Utils.addClass(o,"verificationError"),o.innerHTML=e.message):""==e.message&&(alert(TOP_BODY.ajaxError),document.location.reload())},error:function(){alert(TOP_BODY.ajaxError),document.location.reload()}})}function callbackSuccess(o){var t=currentModalScope.querySelector("#signinLoggingin"),n=currentModalScope.querySelector(".signinError");if("0"==o.premium_redirect_cookie){if(o.showExpiredFreeTrial||o.showExpiredModal||o.showExpiredCovidModal)return expired_modal.startPremiumUrl=o.takeFreePremiumUrl,expired_modal.noThanksBtnUrl=o.redirectToPH,expired_modal.segment=o.segment,expired_modal.isExpiredPromoUser=o.showExpiredModal,o.showExpiredCovidModal?expired_modal.showExpiredCovidModal():expired_modal.showExpiredPromoModal(),void toggleButtonDisable(!1);o.redirect?(t.style.display="block",n.style.display="none",void 0!==o.subscribe&&1==o.subscribe?(document.querySelector(".subscribeButton button.login").setAttribute("data-login","0"),subscribeAjax(e,document.querySelector(".subscribeButton button.login"),"",!0,o.redirect)):document.location.assign(o.redirect)):(n.style.display="block",n.innerHTML=o.message,toggleButtonDisable(!1))}else{var a=new Date,i=premiumRedirectCookieURL+(0<premiumRedirectCookieURL.indexOf("?")?"&":"?")+"timestamp="+a.getTime(),a=new XMLHttpRequest;a.withCredentials=!0,a.open("GET",i,!0),a.onreadystatechange=function(){4===this.readyState&&200<=this.status&&this.status<400&&(o.redirect?(t.style.display="",n.style.display="none",document.location.assign(o.redirect)):(n.style.display="",n.innerHTML=o.message,toggleButtonDisable(!1)))},a.send(),a=null}}function callbackFailed(){location.reload}function collectLoginData(e){for(var o={},t=0;t<e.length;t++){var n=e.item(t);o[n.name]=encodeURIComponent(n.value)}return"redirect="+o.redirect+"&intended_action="+o.intended_action+"&user_id="+o.user_id+"&token="+o.token+"&remember_me="+o.remember_me+"&from="+o.from+"&username="+o.username+"&password="+o.password+"&subscribe="+o.subscribe+"&setSendTip="+(!!localStorage.getItem("tipsClicked")&&localStorage.getItem("tipsClicked"))}function updateDataWithCaptcha(e){var o=currentModalScope.querySelector(".g-recaptcha-response");return o&&o.value?e+"&g-recaptcha-response="+o.value:e}var keyPressed=!1,currentModalScope=null,showCaptcha=!1,loginClickFunction=function(e){var o=currentModalScope.querySelector(".js-loginFormModal").elements;e.preventDefault?e.preventDefault():e.returnValue=!1,loginAjaxModal("/front/authenticate","POST",collectLoginData(o))},keyDownFunction=function(e){var o=e.which||e.keyCode,e=currentModalScope.querySelector(".js-loginFormModal").elements;keyPressed?keyPressed&&13!=o&&(keyPressed=!1):13==o&&(loginAjaxModal("/front/authenticate","POST",collectLoginData(e)),keyPressed=!0)};function passEvents(e){var o=e.querySelectorAll(".signup_field"),t=e.querySelector('[type="checkbox"]'),n=e.querySelector('[name="remember_me"]'),a=e.querySelector(".js-signinUsernameModal"),r=e.querySelector(".js-signinPasswordModal"),l=e.querySelector(".js-loginSubmitModal");for(currentModalScope=e,i=0;i<o.length;i++)MG_Utils.addEventHandler(o[i],"focus",function(){signinbox.inputFocused=!0}),MG_Utils.addEventHandler(o[i],"blur",function(){signinbox.inputFocused=!1});MG_Utils.addEventHandler(t,"click",function(){n.value=t.checked?1:0}),MG_Utils.addEventHandler(l,"click",loginClickFunction),MG_Utils.addEventHandler(a,"keydown",keyDownFunction),MG_Utils.addEventHandler(r,"keydown",keyDownFunction)}MG_Utils.domReady(function(){document.location.search.match(/showSigninBox=true/i)&&null!=document.getElementById("headerLoginLink")&&signinbox.show(),expired_modal.init()});